{"id": "bank_hard_001", "dataset": "bank", "question": "Divide customers into 4 day quartiles. What is the subscription percentage (0-100) in the lower-middle (25-50%) (Q2) quartile?", "gold_code": "df['_bin'] = pd.qcut(df['day'], 4, labels=['Q1','Q2','Q3','Q4'], duplicates='drop')\nbin_data = df[df['_bin'] == 'Q2']\nresult = round((bin_data['y'] == 1).mean() * 100, 2)\ndf.drop('_bin', axis=1, inplace=True)", "expected_output": 14.04, "level": "L4", "template": "quartile_conversion", "output_type": "scalar"}
{"id": "bank_hard_002", "dataset": "bank", "question": "Show the subscription percentage breakdown by job. Return a DataFrame with columns [job, count, rate] where rate is percentage (0-100), sorted by rate descending.", "gold_code": "breakdown = df.groupby('job').agg(\n    count=('y', 'size'),\n    rate=('y', lambda x: round((x == 1).mean() * 100, 2))\n).sort_values('rate', ascending=False)\nresult = breakdown.reset_index()", "expected_output": [{"job": "student", "count": 11767, "rate": 34.08}, {"job": "retired", "count": 35185, "rate": 24.62}, {"job": "unemployed", "count": 17634, "rate": 17.98}, {"job": "management", "count": 175541, "rate": 15.04}, {"job": "self-employed", "count": 19020, "rate": 12.94}, {"job": "unknown", "count": 2917, "rate": 12.07}, {"job": "technician", "count": 138107, "rate": 11.83}, {"job": "admin.", "count": 81492, "rate": 11.65}, {"job": "housemaid", "count": 15912, "rate": 8.47}, {"job": "services", "count": 64209, "rate": 8.27}, {"job": "entrepreneur", "count": 17718, "rate": 8.14}, {"job": "blue-collar", "count": 170498, "rate": 6.74}], "level": "L4", "template": "segment_breakdown", "output_type": "dataframe"}
{"id": "bank_hard_003", "dataset": "bank", "question": "Rank job categories by customer count. Return the top 3 as a list from highest to lowest count.", "gold_code": "counts = df.groupby('job').size().sort_values(ascending=False)\nresult = counts.head(3).index.tolist()", "expected_output": ["management", "blue-collar", "technician"], "level": "L3", "template": "segment_size_ranking", "output_type": "list"}
{"id": "bank_hard_004", "dataset": "bank", "question": "Which month categories are anomalies - having above-median balance but below-median subscription rate? Return sorted list.", "gold_code": "group_stats = df.groupby('month').agg(\n    metric_avg=('balance', 'mean'),\n    rate=('y', lambda x: (x == 1).mean())\n)\nmedian_metric = group_stats['metric_avg'].median()\nmedian_rate = group_stats['rate'].median()\nanomalies = group_stats[(group_stats['metric_avg'] > median_metric) & (group_stats['rate'] < median_rate)]\nresult = sorted(anomalies.index.tolist())", "expected_output": ["nov"], "level": "L5", "template": "anomaly_segments", "output_type": "list"}
{"id": "bank_hard_005", "dataset": "bank", "question": "Find the job with the lowest subscription rate. Within that group, what is the lowest average age?", "gold_code": "group_rates = df.groupby('job')['y'].apply(lambda x: (x == 1).mean())\nouter_val = group_rates.max() if 'lowest' == 'highest' else group_rates.min()\nouter_tied = group_rates[group_rates == outer_val].sort_index()\nouter_group = outer_tied.index[0]\nsubset = df[df['job'] == outer_group]\nresult = round(subset['age'].mean(), 2)", "expected_output": 40.45, "level": "L5", "template": "nested_extrema", "output_type": "scalar"}
{"id": "bank_hard_006", "dataset": "bank", "question": "Which month category has the highest subscription rate? If tied, return alphabetically first.", "gold_code": "rates = df.groupby('month')['y'].apply(lambda x: (x == 1).mean())\nextrema_val = rates.max() if 'highest' == 'highest' else rates.min()\ntied = rates[rates == extrema_val].sort_index()\nresult = tied.index[0]", "expected_output": "mar", "level": "L3", "template": "top_segment", "output_type": "string"}
{"id": "bank_hard_007", "dataset": "bank", "question": "How much higher is the subscription rate for month='may' compared to month='aug'? Return percentage points difference.", "gold_code": "rate_a = (df[df['month'] == 'may']['y'] == 1).mean() * 100\nrate_b = (df[df['month'] == 'aug']['y'] == 1).mean() * 100\nresult = round(rate_a - rate_b, 2)", "expected_output": -4.08, "level": "L3", "template": "conversion_compare", "output_type": "scalar"}
{"id": "bank_hard_008", "dataset": "bank", "question": "Which job categories have more than 50000 customers? Return as a sorted list.", "gold_code": "counts = df.groupby('job').size()\nresult = sorted(counts[counts > 50000].index.tolist())", "expected_output": ["admin.", "blue-collar", "management", "services", "technician"], "level": "L3", "template": "large_segments", "output_type": "list"}
{"id": "bank_hard_009", "dataset": "bank", "question": "Which month category has the lowest average balance? If tied, return alphabetically first.", "gold_code": "group_stats = df.groupby('month')['balance'].mean()\nextrema_val = group_stats.max() if 'lowest' == 'highest' else group_stats.min()\ntied = group_stats[group_stats == extrema_val].sort_index()\nresult = tied.index[0]", "expected_output": "jul", "level": "L3", "template": "top_metric_segment", "output_type": "string"}
{"id": "bank_hard_010", "dataset": "bank", "question": "How much higher is the subscription rate for job='management' compared to job='services'? Return percentage points difference.", "gold_code": "rate_a = (df[df['job'] == 'management']['y'] == 1).mean() * 100\nrate_b = (df[df['job'] == 'services']['y'] == 1).mean() * 100\nresult = round(rate_a - rate_b, 2)", "expected_output": 6.77, "level": "L3", "template": "conversion_compare", "output_type": "scalar"}
{"id": "bank_hard_011", "dataset": "bank", "question": "Which job categories are anomalies - having above-median age but below-median subscription rate? Return sorted list.", "gold_code": "group_stats = df.groupby('job').agg(\n    metric_avg=('age', 'mean'),\n    rate=('y', lambda x: (x == 1).mean())\n)\nmedian_metric = group_stats['metric_avg'].median()\nmedian_rate = group_stats['rate'].median()\nanomalies = group_stats[(group_stats['metric_avg'] > median_metric) & (group_stats['rate'] < median_rate)]\nresult = sorted(anomalies.index.tolist())", "expected_output": ["blue-collar", "entrepreneur", "housemaid"], "level": "L5", "template": "anomaly_segments", "output_type": "list"}
{"id": "bank_hard_012", "dataset": "bank", "question": "How much higher is the average age for month='may' compared to month='nov'?", "gold_code": "avg_a = df[df['month'] == 'may']['age'].mean()\navg_b = df[df['month'] == 'nov']['age'].mean()\nresult = round(avg_a - avg_b, 2)", "expected_output": -2.81, "level": "L3", "template": "metric_compare", "output_type": "scalar"}
{"id": "bank_hard_013", "dataset": "bank", "question": "Divide customers into 4 balance quartiles. What is the subscription percentage (0-100) in the lower-middle (25-50%) (Q2) quartile?", "gold_code": "df['_bin'] = pd.qcut(df['balance'], 4, labels=['Q1','Q2','Q3','Q4'], duplicates='drop')\nbin_data = df[df['_bin'] == 'Q2']\nresult = round((bin_data['y'] == 1).mean() * 100, 2)\ndf.drop('_bin', axis=1, inplace=True)", "expected_output": 10.96, "level": "L4", "template": "quartile_conversion", "output_type": "scalar"}
{"id": "bank_hard_014", "dataset": "bank", "question": "How much higher is the subscription rate in the Q4 balance quartile compared to Q1? Return percentage points.", "gold_code": "df['_bin'] = pd.qcut(df['balance'], 4, labels=['Q1','Q2','Q3','Q4'], duplicates='drop')\nrate_a = (df[df['_bin'] == 'Q4']['y'] == 1).mean() * 100\nrate_b = (df[df['_bin'] == 'Q1']['y'] == 1).mean() * 100\nresult = round(rate_a - rate_b, 2)\ndf.drop('_bin', axis=1, inplace=True)", "expected_output": 16.95, "level": "L4", "template": "quartile_comparison", "output_type": "scalar"}
{"id": "bank_hard_015", "dataset": "bank", "question": "Score each job by opportunity: (count * (1 - subscription_rate) * avg_day). Return a DataFrame with top 5 segments showing [count, rate (percentage 0-100), avg_metric, opportunity_score], sorted by score descending.", "gold_code": "group_stats = df.groupby('job').agg(\n    count=('y', 'size'),\n    rate=('y', lambda x: (x == 1).mean()),\n    avg_metric=('day', 'mean')\n)\ngroup_stats['opportunity_score'] = round(group_stats['count'] * (1 - group_stats['rate']) * group_stats['avg_metric'], 2)\ntop_opportunities = group_stats.nlargest(5, 'opportunity_score')[['count', 'rate', 'avg_metric', 'opportunity_score']]\ntop_opportunities['rate'] = round(top_opportunities['rate'] * 100, 2)\ntop_opportunities['avg_metric'] = round(top_opportunities['avg_metric'], 2)\nresult = top_opportunities.reset_index()", "expected_output": [{"job": "blue-collar", "count": 170498, "rate": 6.74, "avg_metric": 15.7, "opportunity_score": 2496931.72}, {"job": "management", "count": 175541, "rate": 15.04, "avg_metric": 16.37, "opportunity_score": 2440829.71}, {"job": "technician", "count": 138107, "rate": 11.83, "avg_metric": 16.83, "opportunity_score": 2049213.5}, {"job": "admin.", "count": 81492, "rate": 11.65, "avg_metric": 15.91, "opportunity_score": 1145651.91}, {"job": "services", "count": 64209, "rate": 8.27, "avg_metric": 15.97, "opportunity_score": 940815.95}], "level": "L5", "template": "cross_metric_opportunity", "output_type": "dataframe"}
{"id": "bank_hard_016", "dataset": "bank", "question": "Find the job with the highest subscription rate. Within that group, what is the lowest average age?", "gold_code": "group_rates = df.groupby('job')['y'].apply(lambda x: (x == 1).mean())\nouter_val = group_rates.max() if 'highest' == 'highest' else group_rates.min()\nouter_tied = group_rates[group_rates == outer_val].sort_index()\nouter_group = outer_tied.index[0]\nsubset = df[df['job'] == outer_group]\nresult = round(subset['age'].mean(), 2)", "expected_output": 26.69, "level": "L5", "template": "nested_extrema", "output_type": "scalar"}
{"id": "bank_hard_017", "dataset": "bank", "question": "Score each job by opportunity: (count * (1 - subscription_rate) * avg_balance). Return a DataFrame with top 5 segments showing [count, rate (percentage 0-100), avg_metric, opportunity_score], sorted by score descending.", "gold_code": "group_stats = df.groupby('job').agg(\n    count=('y', 'size'),\n    rate=('y', lambda x: (x == 1).mean()),\n    avg_metric=('balance', 'mean')\n)\ngroup_stats['opportunity_score'] = round(group_stats['count'] * (1 - group_stats['rate']) * group_stats['avg_metric'], 2)\ntop_opportunities = group_stats.nlargest(5, 'opportunity_score')[['count', 'rate', 'avg_metric', 'opportunity_score']]\ntop_opportunities['rate'] = round(top_opportunities['rate'] * 100, 2)\ntop_opportunities['avg_metric'] = round(top_opportunities['avg_metric'], 2)\nresult = top_opportunities.reset_index()", "expected_output": [{"job": "management", "count": 175541, "rate": 15.04, "avg_metric": 1510.39, "opportunity_score": 225260371.52}, {"job": "blue-collar", "count": 170498, "rate": 6.74, "avg_metric": 977.49, "opportunity_score": 155421574.9}, {"job": "technician", "count": 138107, "rate": 11.83, "avg_metric": 1071.57, "opportunity_score": 130480979.54}, {"job": "admin.", "count": 81492, "rate": 11.65, "avg_metric": 1019.92, "opportunity_score": 73436609.72}, {"job": "services", "count": 64209, "rate": 8.27, "avg_metric": 834.63, "opportunity_score": 49157784.87}], "level": "L5", "template": "cross_metric_opportunity", "output_type": "dataframe"}
{"id": "bank_hard_018", "dataset": "bank", "question": "Find the month with the lowest subscription rate. Within that group, what is the lowest average balance?", "gold_code": "group_rates = df.groupby('month')['y'].apply(lambda x: (x == 1).mean())\nouter_val = group_rates.max() if 'lowest' == 'highest' else group_rates.min()\nouter_tied = group_rates[group_rates == outer_val].sort_index()\nouter_group = outer_tied.index[0]\nsubset = df[df['month'] == outer_group]\nresult = round(subset['balance'].mean(), 2)", "expected_output": 917.76, "level": "L5", "template": "nested_extrema", "output_type": "scalar"}
{"id": "bank_hard_019", "dataset": "bank", "question": "Among customers in the top quartile of day, which month categories have below-average subscription rate? Return sorted list.", "gold_code": "df['_bin'] = pd.qcut(df['day'], 4, labels=['Q1','Q2','Q3','Q4'], duplicates='drop')\ntop_quartile = df[df['_bin'] == 'Q4']\noverall_rate = (top_quartile['y'] == 1).mean()\ngroup_rates = top_quartile.groupby('month')['y'].apply(lambda x: (x == 1).mean())\nunderperformers = group_rates[group_rates < overall_rate].sort_index()\nresult = underperformers.index.tolist()\ndf.drop('_bin', axis=1, inplace=True)", "expected_output": ["aug", "jan", "jul", "may"], "level": "L5", "template": "high_value_underperformers", "output_type": "list"}
{"id": "bank_hard_020", "dataset": "bank", "question": "Find the month with highest average age. What is the subscription rate for that segment?", "gold_code": "group_stats = df.groupby('month')['age'].mean()\nextrema_val = group_stats.max() if 'highest' == 'highest' else group_stats.min()\ntied = group_stats[group_stats == extrema_val].sort_index()\nextrema_group = tied.index[0]\nsubset = df[df['month'] == extrema_group]\nresult = round((subset['y'] == 1).mean() * 100, 2)", "expected_output": 49.0, "level": "L5", "template": "chain_conversion", "output_type": "scalar"}
{"id": "bank_hard_021", "dataset": "bank", "question": "Show the subscription percentage breakdown by month. Return a DataFrame with columns [month, count, rate] where rate is percentage (0-100), sorted by rate descending.", "gold_code": "breakdown = df.groupby('month').agg(\n    count=('y', 'size'),\n    rate=('y', lambda x: round((x == 1).mean() * 100, 2))\n).sort_values('rate', ascending=False)\nresult = breakdown.reset_index()", "expected_output": [{"month": "mar", "count": 5802, "rate": 57.14}, {"month": "sep", "count": 7409, "rate": 53.48}, {"month": "dec", "count": 2069, "rate": 51.33}, {"month": "oct", "count": 9204, "rate": 49.0}, {"month": "apr", "count": 41319, "rate": 23.57}, {"month": "feb", "count": 37611, "rate": 20.68}, {"month": "jan", "count": 18937, "rate": 12.41}, {"month": "aug", "count": 128859, "rate": 11.22}, {"month": "nov", "count": 66062, "rate": 10.98}, {"month": "jun", "count": 93670, "rate": 10.37}, {"month": "jul", "count": 110647, "rate": 9.08}, {"month": "may", "count": 228411, "rate": 7.14}], "level": "L4", "template": "segment_breakdown", "output_type": "dataframe"}
{"id": "bank_hard_022", "dataset": "bank", "question": "Divide customers into 4 day quartiles. What is the subscription percentage (0-100) in the lowest (bottom 25%) (Q1) quartile?", "gold_code": "df['_bin'] = pd.qcut(df['day'], 4, labels=['Q1','Q2','Q3','Q4'], duplicates='drop')\nbin_data = df[df['_bin'] == 'Q1']\nresult = round((bin_data['y'] == 1).mean() * 100, 2)\ndf.drop('_bin', axis=1, inplace=True)", "expected_output": 13.43, "level": "L4", "template": "quartile_conversion", "output_type": "scalar"}
{"id": "bank_hard_023", "dataset": "bank", "question": "How much higher is the subscription rate for month='may' compared to month='jun'? Return percentage points difference.", "gold_code": "rate_a = (df[df['month'] == 'may']['y'] == 1).mean() * 100\nrate_b = (df[df['month'] == 'jun']['y'] == 1).mean() * 100\nresult = round(rate_a - rate_b, 2)", "expected_output": -3.24, "level": "L3", "template": "conversion_compare", "output_type": "scalar"}
{"id": "bank_hard_024", "dataset": "bank", "question": "How much higher is the subscription rate in the Q4 day quartile compared to Q2? Return percentage points.", "gold_code": "df['_bin'] = pd.qcut(df['day'], 4, labels=['Q1','Q2','Q3','Q4'], duplicates='drop')\nrate_a = (df[df['_bin'] == 'Q4']['y'] == 1).mean() * 100\nrate_b = (df[df['_bin'] == 'Q2']['y'] == 1).mean() * 100\nresult = round(rate_a - rate_b, 2)\ndf.drop('_bin', axis=1, inplace=True)", "expected_output": -2.48, "level": "L4", "template": "quartile_comparison", "output_type": "scalar"}
{"id": "bank_hard_025", "dataset": "bank", "question": "Divide customers into 4 day quartiles. What is the average age in the upper-middle (50-75%) (Q3) quartile?", "gold_code": "df['_bin'] = pd.qcut(df['day'], 4, labels=['Q1','Q2','Q3','Q4'], duplicates='drop')\nbin_data = df[df['_bin'] == 'Q3']\nresult = round(bin_data['age'].mean(), 2)\ndf.drop('_bin', axis=1, inplace=True)", "expected_output": 40.33, "level": "L4", "template": "quartile_stat", "output_type": "scalar"}
{"id": "bank_hard_026", "dataset": "bank", "question": "Find the month with the highest subscription rate. Within that group, what is the lowest average day?", "gold_code": "group_rates = df.groupby('month')['y'].apply(lambda x: (x == 1).mean())\nouter_val = group_rates.max() if 'highest' == 'highest' else group_rates.min()\nouter_tied = group_rates[group_rates == outer_val].sort_index()\nouter_group = outer_tied.index[0]\nsubset = df[df['month'] == outer_group]\nresult = round(subset['day'].mean(), 2)", "expected_output": 13.45, "level": "L5", "template": "nested_extrema", "output_type": "scalar"}
{"id": "bank_hard_027", "dataset": "bank", "question": "Divide customers into 4 balance quartiles. What is the subscription percentage (0-100) in the highest (top 25%) (Q4) quartile?", "gold_code": "df['_bin'] = pd.qcut(df['balance'], 4, labels=['Q1','Q2','Q3','Q4'], duplicates='drop')\nbin_data = df[df['_bin'] == 'Q4']\nresult = round((bin_data['y'] == 1).mean() * 100, 2)\ndf.drop('_bin', axis=1, inplace=True)", "expected_output": 20.48, "level": "L4", "template": "quartile_conversion", "output_type": "scalar"}
{"id": "bank_hard_028", "dataset": "bank", "question": "Which job categories have below-average subscription rate but above-average customer count? These are opportunity segments. Return sorted list.", "gold_code": "overall_rate = (df['y'] == 1).mean()\noverall_count = len(df) / df['job'].nunique()\ngroup_stats = df.groupby('job').agg(\n    rate=('y', lambda x: (x == 1).mean()),\n    count=('y', 'size')\n)\nopportunities = group_stats[(group_stats['rate'] < overall_rate) & (group_stats['count'] > overall_count)]\nresult = sorted(opportunities.index.tolist())", "expected_output": ["admin.", "blue-collar", "services", "technician"], "level": "L5", "template": "opportunity_segments", "output_type": "list"}
{"id": "bank_hard_029", "dataset": "bank", "question": "What percentage of month categories have subscription rates above the overall average?", "gold_code": "overall_rate = (df['y'] == 1).mean()\ngroup_rates = df.groupby('month')['y'].apply(lambda x: (x == 1).mean())\nresult = round((group_rates > overall_rate).mean() * 100, 2)", "expected_output": 58.33, "level": "L4", "template": "cross_segment_pct", "output_type": "scalar"}
{"id": "bank_hard_030", "dataset": "bank", "question": "Find the job with the highest subscription rate. Within that group, what is the lowest average day?", "gold_code": "group_rates = df.groupby('job')['y'].apply(lambda x: (x == 1).mean())\nouter_val = group_rates.max() if 'highest' == 'highest' else group_rates.min()\nouter_tied = group_rates[group_rates == outer_val].sort_index()\nouter_group = outer_tied.index[0]\nsubset = df[df['job'] == outer_group]\nresult = round(subset['day'].mean(), 2)", "expected_output": 15.06, "level": "L5", "template": "nested_extrema", "output_type": "scalar"}
{"id": "bank_hard_031", "dataset": "bank", "question": "Show the average balance breakdown by month. Include count and mean balance for each category, sorted by mean descending.", "gold_code": "breakdown = df.groupby('month').agg(\n    count=('balance', 'size'),\n    mean_balance=('balance', lambda x: round(x.mean(), 2))\n).sort_values('mean_balance', ascending=False)\nresult = breakdown.reset_index()", "expected_output": [{"month": "mar", "count": 5802, "mean_balance": 2416.54}, {"month": "dec", "count": 2069, "mean_balance": 2324.67}, {"month": "oct", "count": 9204, "mean_balance": 2319.53}, {"month": "sep", "count": 7409, "mean_balance": 2285.48}, {"month": "nov", "count": 66062, "mean_balance": 2239.35}, {"month": "apr", "count": 41319, "mean_balance": 1560.26}, {"month": "feb", "count": 37611, "mean_balance": 1332.04}, {"month": "jun", "count": 93670, "mean_balance": 1331.01}, {"month": "aug", "count": 128859, "mean_balance": 1140.68}, {"month": "jan", "count": 18937, "mean_balance": 1013.82}, {"month": "may", "count": 228411, "mean_balance": 917.76}, {"month": "jul", "count": 110647, "mean_balance": 749.64}], "level": "L4", "template": "metric_breakdown", "output_type": "dataframe"}
{"id": "bank_hard_032", "dataset": "bank", "question": "How much higher is the subscription rate for job='management' compared to job='admin.'? Return percentage points difference.", "gold_code": "rate_a = (df[df['job'] == 'management']['y'] == 1).mean() * 100\nrate_b = (df[df['job'] == 'admin.']['y'] == 1).mean() * 100\nresult = round(rate_a - rate_b, 2)", "expected_output": 3.39, "level": "L3", "template": "conversion_compare", "output_type": "scalar"}
{"id": "bank_hard_033", "dataset": "bank", "question": "What percentage of job='management' customers have day above the overall average day?", "gold_code": "overall_avg = df['day'].mean()\nsubset = df[df['job'] == 'management']\nresult = round((subset['day'] > overall_avg).mean() * 100, 2)", "expected_output": 53.88, "level": "L3", "template": "above_average_pct", "output_type": "scalar"}
{"id": "bank_hard_034", "dataset": "bank", "question": "Which month categories have below-average subscription rate but above-average customer count? These are opportunity segments. Return sorted list.", "gold_code": "overall_rate = (df['y'] == 1).mean()\noverall_count = len(df) / df['month'].nunique()\ngroup_stats = df.groupby('month').agg(\n    rate=('y', lambda x: (x == 1).mean()),\n    count=('y', 'size')\n)\nopportunities = group_stats[(group_stats['rate'] < overall_rate) & (group_stats['count'] > overall_count)]\nresult = sorted(opportunities.index.tolist())", "expected_output": ["aug", "jul", "jun", "may", "nov"], "level": "L5", "template": "opportunity_segments", "output_type": "list"}
{"id": "bank_hard_035", "dataset": "bank", "question": "Show the average age breakdown by job. Include count and mean age for each category, sorted by mean descending.", "gold_code": "breakdown = df.groupby('job').agg(\n    count=('age', 'size'),\n    mean_age=('age', lambda x: round(x.mean(), 2))\n).sort_values('mean_age', ascending=False)\nresult = breakdown.reset_index()", "expected_output": [{"job": "retired", "count": 35185, "mean_age": 60.49}, {"job": "unknown", "count": 2917, "mean_age": 48.33}, {"job": "housemaid", "count": 15912, "mean_age": 47.18}, {"job": "entrepreneur", "count": 17718, "mean_age": 42.56}, {"job": "unemployed", "count": 17634, "mean_age": 40.97}, {"job": "blue-collar", "count": 170498, "mean_age": 40.45}, {"job": "self-employed", "count": 19020, "mean_age": 40.42}, {"job": "management", "count": 175541, "mean_age": 40.2}, {"job": "admin.", "count": 81492, "mean_age": 39.68}, {"job": "technician", "count": 138107, "mean_age": 39.31}, {"job": "services", "count": 64209, "mean_age": 38.94}, {"job": "student", "count": 11767, "mean_age": 26.69}], "level": "L4", "template": "metric_breakdown", "output_type": "dataframe"}
{"id": "bank_hard_036", "dataset": "bank", "question": "Find the job with the lowest subscription rate. Within that group, what is the highest average day?", "gold_code": "group_rates = df.groupby('job')['y'].apply(lambda x: (x == 1).mean())\nouter_val = group_rates.max() if 'lowest' == 'highest' else group_rates.min()\nouter_tied = group_rates[group_rates == outer_val].sort_index()\nouter_group = outer_tied.index[0]\nsubset = df[df['job'] == outer_group]\nresult = round(subset['day'].mean(), 2)", "expected_output": 15.7, "level": "L5", "template": "nested_extrema", "output_type": "scalar"}
{"id": "bank_hard_037", "dataset": "bank", "question": "Which job categories would have the biggest impact if brought to average subscription rate? Return top 3 by potential gain (count * rate gap), sorted by impact.", "gold_code": "overall_rate = (df['y'] == 1).mean()\ngroup_stats = df.groupby('job').agg(\n    rate=('y', lambda x: (x == 1).mean()),\n    count=('y', 'size')\n)\ngroup_stats['gap'] = overall_rate - group_stats['rate']\ngroup_stats['potential'] = group_stats['count'] * group_stats['gap']\ntop_potential = group_stats[group_stats['gap'] > 0].nlargest(3, 'potential')\nresult = top_potential.index.tolist()", "expected_output": ["blue-collar", "services", "entrepreneur"], "level": "L5", "template": "segment_improvement_potential", "output_type": "list"}
{"id": "bank_hard_038", "dataset": "bank", "question": "Find the month with the highest subscription rate. Within that group, what is the lowest average balance?", "gold_code": "group_rates = df.groupby('month')['y'].apply(lambda x: (x == 1).mean())\nouter_val = group_rates.max() if 'highest' == 'highest' else group_rates.min()\nouter_tied = group_rates[group_rates == outer_val].sort_index()\nouter_group = outer_tied.index[0]\nsubset = df[df['month'] == outer_group]\nresult = round(subset['balance'].mean(), 2)", "expected_output": 2416.54, "level": "L5", "template": "nested_extrema", "output_type": "scalar"}
{"id": "bank_hard_039", "dataset": "bank", "question": "Show the subscription percentage breakdown by day quartiles. Return a DataFrame with columns [quartile, count, rate] where rate is percentage (0-100).", "gold_code": "df['_bin'] = pd.qcut(df['day'], 4, labels=['Q1','Q2','Q3','Q4'], duplicates='drop')\nbreakdown = df.groupby('_bin').agg(\n    count=('y', 'size'),\n    rate=('y', lambda x: round((x == 1).mean() * 100, 2))\n).reset_index()\nbreakdown.columns = ['quartile', 'count', 'rate']\nresult = breakdown\ndf.drop('_bin', axis=1, inplace=True)", "expected_output": [{"quartile": "Q1", "count": 207327, "rate": 13.43}, {"quartile": "Q2", "count": 197668, "rate": 14.04}, {"quartile": "Q3", "count": 159126, "rate": 8.43}, {"quartile": "Q4", "count": 185879, "rate": 11.55}], "level": "L4", "template": "quartile_breakdown", "output_type": "dataframe"}
{"id": "bank_hard_040", "dataset": "bank", "question": "Among customers in the top quartile of age, which month categories have below-average subscription rate? Return sorted list.", "gold_code": "df['_bin'] = pd.qcut(df['age'], 4, labels=['Q1','Q2','Q3','Q4'], duplicates='drop')\ntop_quartile = df[df['_bin'] == 'Q4']\noverall_rate = (top_quartile['y'] == 1).mean()\ngroup_rates = top_quartile.groupby('month')['y'].apply(lambda x: (x == 1).mean())\nunderperformers = group_rates[group_rates < overall_rate].sort_index()\nresult = underperformers.index.tolist()\ndf.drop('_bin', axis=1, inplace=True)", "expected_output": ["aug", "jul", "jun", "may", "nov"], "level": "L5", "template": "high_value_underperformers", "output_type": "list"}
{"id": "bank_hard_041", "dataset": "bank", "question": "Find the job with the highest subscription rate. Within that group, what is the highest average age?", "gold_code": "group_rates = df.groupby('job')['y'].apply(lambda x: (x == 1).mean())\nouter_val = group_rates.max() if 'highest' == 'highest' else group_rates.min()\nouter_tied = group_rates[group_rates == outer_val].sort_index()\nouter_group = outer_tied.index[0]\nsubset = df[df['job'] == outer_group]\nresult = round(subset['age'].mean(), 2)", "expected_output": 26.69, "level": "L5", "template": "nested_extrema", "output_type": "scalar"}
{"id": "bank_hard_042", "dataset": "bank", "question": "Divide customers into 4 age quartiles. What is the subscription percentage (0-100) in the upper-middle (50-75%) (Q3) quartile?", "gold_code": "df['_bin'] = pd.qcut(df['age'], 4, labels=['Q1','Q2','Q3','Q4'], duplicates='drop')\nbin_data = df[df['_bin'] == 'Q3']\nresult = round((bin_data['y'] == 1).mean() * 100, 2)\ndf.drop('_bin', axis=1, inplace=True)", "expected_output": 9.1, "level": "L4", "template": "quartile_conversion", "output_type": "scalar"}
{"id": "bank_hard_043", "dataset": "bank", "question": "Divide customers into 4 balance quartiles. What is the average balance in the highest (top 25%) (Q4) quartile?", "gold_code": "df['_bin'] = pd.qcut(df['balance'], 4, labels=['Q1','Q2','Q3','Q4'], duplicates='drop')\nbin_data = df[df['_bin'] == 'Q4']\nresult = round(bin_data['balance'].mean(), 2)\ndf.drop('_bin', axis=1, inplace=True)", "expected_output": 3759.86, "level": "L4", "template": "quartile_stat", "output_type": "scalar"}
{"id": "bank_hard_044", "dataset": "bank", "question": "Which month categories have subscription rates below 10%? Return as a sorted list.", "gold_code": "rates = df.groupby('month')['y'].apply(lambda x: (x == 1).mean() * 100)\nresult = sorted(rates[rates < 10].index.tolist())", "expected_output": ["jul", "may"], "level": "L3", "template": "low_performers", "output_type": "list"}
{"id": "bank_hard_045", "dataset": "bank", "question": "Which month categories would have the biggest impact if brought to average subscription rate? Return top 3 by potential gain (count * rate gap), sorted by impact.", "gold_code": "overall_rate = (df['y'] == 1).mean()\ngroup_stats = df.groupby('month').agg(\n    rate=('y', lambda x: (x == 1).mean()),\n    count=('y', 'size')\n)\ngroup_stats['gap'] = overall_rate - group_stats['rate']\ngroup_stats['potential'] = group_stats['count'] * group_stats['gap']\ntop_potential = group_stats[group_stats['gap'] > 0].nlargest(3, 'potential')\nresult = top_potential.index.tolist()", "expected_output": ["may", "jul", "jun"], "level": "L5", "template": "segment_improvement_potential", "output_type": "list"}
{"id": "bank_hard_046", "dataset": "bank", "question": "Divide customers into 4 balance quartiles. What is the subscription percentage (0-100) in the upper-middle (50-75%) (Q3) quartile?", "gold_code": "df['_bin'] = pd.qcut(df['balance'], 4, labels=['Q1','Q2','Q3','Q4'], duplicates='drop')\nbin_data = df[df['_bin'] == 'Q3']\nresult = round((bin_data['y'] == 1).mean() * 100, 2)\ndf.drop('_bin', axis=1, inplace=True)", "expected_output": 13.72, "level": "L4", "template": "quartile_conversion", "output_type": "scalar"}
{"id": "bank_hard_047", "dataset": "bank", "question": "What percentage of job categories have subscription rates above the overall average?", "gold_code": "overall_rate = (df['y'] == 1).mean()\ngroup_rates = df.groupby('job')['y'].apply(lambda x: (x == 1).mean())\nresult = round((group_rates > overall_rate).mean() * 100, 2)", "expected_output": 50.0, "level": "L4", "template": "cross_segment_pct", "output_type": "scalar"}
{"id": "bank_hard_048", "dataset": "bank", "question": "Find the month with lowest average balance. What is the subscription rate for that segment?", "gold_code": "group_stats = df.groupby('month')['balance'].mean()\nextrema_val = group_stats.max() if 'lowest' == 'highest' else group_stats.min()\ntied = group_stats[group_stats == extrema_val].sort_index()\nextrema_group = tied.index[0]\nsubset = df[df['month'] == extrema_group]\nresult = round((subset['y'] == 1).mean() * 100, 2)", "expected_output": 9.08, "level": "L5", "template": "chain_conversion", "output_type": "scalar"}
{"id": "bank_hard_049", "dataset": "bank", "question": "Which month categories have subscription rates above 10%? Return as a sorted list.", "gold_code": "rates = df.groupby('month')['y'].apply(lambda x: (x == 1).mean() * 100)\nresult = sorted(rates[rates > 10].index.tolist())", "expected_output": ["apr", "aug", "dec", "feb", "jan", "jun", "mar", "nov", "oct", "sep"], "level": "L3", "template": "segment_ranking", "output_type": "list"}
